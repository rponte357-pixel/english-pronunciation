<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pronunciaci√≥n del -ed en Ingl√©s</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-width: 150px;
            flex: 1;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }

        .controls {
            padding: 30px 40px;
            background: white;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
            border-bottom: 2px solid #e9ecef;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 12px 24px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .mode-toggle {
            padding: 12px 24px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .mode-toggle:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .rules-section {
            padding: 40px;
            background: #f8f9fa;
        }

        .rules-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .summary-table th, .summary-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .summary-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .summary-table tr:hover {
            background: #f8f9fa;
        }

        .verb-lists-section {
            padding: 40px;
        }

        .verb-list-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
        }

        .verb-list {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .verb-list:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .verb-list h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .verb-list.id-list h3 { color: #dc3545; border-bottom-color: #dc3545; }
        .verb-list.t-list h3 { color: #ffc107; border-bottom-color: #ffc107; }
        .verb-list.d-list h3 { color: #28a745; border-bottom-color: #28a745; }

        .verb-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .verb-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 2px solid transparent;
            position: relative; 
        }
        
        .verb-item .example-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1001;
            bottom: 100%;
            left: 50%;
            margin-left: -100px; 
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            font-size: 0.9em;
            line-height: 1.4;
            white-space: normal;
        }
        
        .verb-item:hover .example-text {
            visibility: visible;
            opacity: 1;
        }
        
        .verb-item .example-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .verb-item:hover {
            background: #667eea;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .verb-item.played {
            background: #e7f5ff;
            border-color: #667eea;
        }

        .verb-item.played::after {
            content: '‚úì';
            position: absolute;
            top: -5px;
            right: -5px;
            background: #28a745;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .verb-item:active {
            transform: scale(0.95);
        }

        .practice-mode {
            display: none;
            padding: 40px;
            background: #f8f9fa;
        }

        .practice-mode.active {
            display: block;
        }

        .quiz-container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .quiz-question {
            font-size: 1.5em;
            margin-bottom: 30px;
            text-align: center;
            color: #333;
        }

        .quiz-verb {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin: 30px 0;
            text-align: center;
        }

        .quiz-options {
            display: grid;
            gap: 15px;
            margin-top: 30px;
        }

        .quiz-option {
            padding: 20px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1em;
            text-align: center;
        }

        .quiz-option:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .quiz-option.correct {
            background: #d4edda;
            border-color: #28a745;
            animation: pulse 0.5s;
        }

        .quiz-option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            animation: shake 0.5s;
        }

        .quiz-score {
            text-align: center;
            margin-top: 30px;
            font-size: 1.3em;
            color: #667eea;
            font-weight: 600;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* üß© ESTILOS DRAG & DROP */
        .drag-option {
            padding: 15px 25px;
            background: #764ba2; /* Morado */
            color: white;
            border-radius: 8px;
            cursor: grab;
            font-size: 1.2em;
            font-weight: bold;
            transition: transform 0.2s, opacity 0.2s;
            user-select: none;
        }

        .drag-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        #dropZone.correct {
            background-color: #d4edda;
            border-color: #28a745;
            color: #28a745;
        }

        #dropZone.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #dc3545;
            animation: shake 0.5s;
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            .stats-bar { flex-direction: column; }
            .controls { flex-direction: column; }
            .verb-list-container { grid-template-columns: 1fr; }
        }

        .hidden {
            display: none !important;
        }

        .audio-player-float {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            min-width: 300px;
        }

        .audio-player-float.show {
            display: block;
            animation: slideUp 0.3s;
        }

        .audio-player-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>üéØ Pronunciaci√≥n del -ed en Ingl√©s</h1>
            <p>Pasa el rat√≥n sobre un verbo para ver el ejemplo y haz clic para escuchar</p>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="totalVerbs">120</div>
                <div class="stat-label">Verbos Totales</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="practicedVerbs">0</div>
                <div class="stat-label">Escuchados</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="quizScore">0/0</div>
                <div class="stat-label">Quiz Score</div>
            </div>
        </div>

        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="üîç Buscar verbo...">
            </div>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">Todos</button>
                <button class="filter-btn" data-filter="id">üî¥ /…™d/</button>
                <button class="filter-btn" data-filter="t">üü° /t/</button>
                <button class="filter-btn" data-filter="d">üü¢ /d/</button>
            </div>
            <button class="mode-toggle" onclick="togglePracticeMode()">üéÆ Modo Pr√°ctica</button>
        </div>

        <div class="rules-section" id="rulesSection">
            <h2>üìö Reglas de Pronunciaci√≥n</h2>
            <table class="summary-table">
                <thead>
                    <tr>
                        <th>Sonido</th>
                        <th>Regla</th>
                        <th>Ejemplo</th>
                        <th>Caracter√≠stica</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>/…™d/</strong></td>
                        <td>Termina en <strong>/t/</strong> o <strong>/d/</strong></td>
                        <td>Wait ‚Üí Wait<strong>ed</strong></td>
                        <td>üî¥ S√≠laba EXTRA</td>
                    </tr>
                    <tr>
                        <td><strong>/t/</strong></td>
                        <td>Termina en sonido <strong>sordo</strong></td>
                        <td>Look ‚Üí Look<strong>ed</strong></td>
                        <td>üü° Sordo + Sordo</td>
                    </tr>
                    <tr>
                    <tr>
                        <td><strong>/d/</strong></td>
                        <td>Termina en sonido <strong>sonoro</strong> o vocal</td>
                        <td>Clean ‚Üí Clean<strong>ed</strong></td>
                        <td>üü¢ Sonoro + Sonoro</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="verb-lists-section" id="verbListsSection">
            <div class="verb-list-container" id="verbListContainer"></div>
        </div>

        <div class="practice-mode" id="practiceMode">
            <div class="quiz-container">
                <h2 style="text-align: center; color: #667eea; margin-bottom: 30px;">üéÆ Modo Pr√°ctica</h2>
                <div class="quiz-question">¬øC√≥mo se pronuncia el -ed en este verbo?</div>
                <div class="quiz-verb" id="quizVerb">Loading...</div>
                <div class="quiz-options" id="quizOptions"></div>
                <div class="quiz-score" id="currentScore">Puntuaci√≥n: 0/0</div>
                
                <div id="dragDropChallenge" class="hidden" style="margin-top: 30px; padding: 20px; border: 1px solid #667eea; border-radius: 10px; background: #e7f5ff;">
                    <h3 style="color: #667eea; text-align: center; margin-bottom: 20px;">üß© Desaf√≠o: Completa la Frase</h3>
                    
                    <div id="sentenceDisplay" style="font-size: 1.4em; text-align: center; margin-bottom: 25px;">
                        </div>
                    
                    <div style="text-align: center;">
                        <div id="dropZone" 
                            ondragover="allowDrop(event)" 
                            ondrop="drop(event)" 
                            style="display: inline-block; padding: 15px 30px; border: 3px dashed #667eea; background: white; border-radius: 10px; font-size: 1.2em; min-width: 180px; color: #667eea; font-weight: bold;">
                            Arrastra o toca aqu√≠
                        </div>
                    </div>
                    
                    <div id="dragOptions" style="display: flex; justify-content: center; gap: 20px; margin-top: 30px;">
                        </div>
                    
                    <div id="challengeFeedback" style="text-align: center; margin-top: 15px; font-weight: bold;"></div>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="mode-toggle" id="nextQuestionBtn" onclick="nextQuestion()">Siguiente ‚û°Ô∏è</button>
                    <button class="mode-toggle" style="background: #dc3545; margin-left: 10px;" onclick="togglePracticeMode()">Volver</button>
                </div>
            </div>
        </div>
    </div>

    <div class="audio-player-float" id="audioPlayer">
        <div class="audio-player-title" id="audioTitle">üîä Reproduciendo...</div>
        <audio id="audioElement" controls style="width: 100%; margin-top: 10px;"></audio>
    </div>

    <script>
        const verbData = {
            id: [
                { verb: 'Accepted', example: 'The team accepted the challenge happily.' },
                { verb: 'Added', example: 'She added some salt to the soup.' },
                { verb: 'Afforded', example: 'I wish I could have afforded that trip.' },
                { verb: 'Collected', example: 'We collected stamps as children.' },
                { verb: 'Completed', example: 'He completed the marathon in 3 hours.' },
                { verb: 'Counted', example: 'She counted the money carefully.' },
                { verb: 'Defended', example: 'The lawyer defended his client successfully.' },
                { verb: 'Decided', example: 'They decided to move to the countryside.' },
                { verb: 'Depended', example: 'My salary depended on commission.' },
                { verb: 'Doubted', example: 'Nobody doubted his innocence.' },
                { verb: 'Ended', example: 'The movie ended with a surprise twist.' },
                { verb: 'Expanded', example: 'The company expanded its market overseas.' },
                { verb: 'Expected', example: 'I expected you to be on time.' },
                { verb: 'Guarded', example: 'The dog guarded the house all night.' },
                { verb: 'Hated', example: 'I hated waking up early on Sundays.' },
                { verb: 'Heated', example: 'He heated the milk in the microwave.' },
                { verb: 'Included', example: 'The price included taxes and service.' },
                { verb: 'Intended', example: 'She intended to apologize later.' },
                { verb: 'Invented', example: 'Who invented the light bulb?' },
                { verb: 'Landed', example: 'The plane landed smoothly on the runway.' },
                { verb: 'Lasted', example: 'The meeting lasted for two long hours.' },
                { verb: 'Loaded', example: 'We loaded the truck with heavy boxes.' },
                { verb: 'Needed', example: 'I needed help with my homework.' },
                { verb: 'Objected', example: 'The defense objected to the question.' },
                { verb: 'Ordered', example: 'We ordered pizza for dinner last night.' },
                { verb: 'Planted', example: 'They planted flowers in the garden.' },
                { verb: 'Pretended', example: 'The child pretended to be a superhero.' },
                { verb: 'Printed', example: 'I printed the document this morning.' },
                { verb: 'Provided', example: 'The hotel provided free breakfast.' },
                { verb: 'Recorded', example: 'The band recorded a new album.' },
                { verb: 'Regretted', example: 'He regretted his decision to quit.' },
                { verb: 'Reminded', example: 'She reminded me of my appointment.' },
                { verb: 'Reported', example: 'The journalist reported on the elections.' },
                { verb: 'Requested', example: 'The client requested a full refund.' },
                { verb: 'Started', example: 'The race started exactly at noon.' },
                { verb: 'Submitted', example: 'I submitted my application yesterday.' },
                { verb: 'Supported', example: 'The community supported the new park.' },
                { verb: 'Treated', example: 'The doctor treated her cold quickly.' },
                { verb: 'Visited', example: 'We visited Paris last summer.' },
                { verb: 'Wanted', example: 'I wanted to tell you a secret.' }
            ],
            t: [
                { verb: 'Asked', example: 'He asked me for directions.' },
                { verb: 'Brushed', example: 'I brushed my teeth before bed.' },
                { verb: 'Clapped', example: 'The audience clapped for the singer.' },
                { verb: 'Cooked', example: 'My mom cooked a delicious meal.' },
                { verb: 'Crashed', example: 'The car crashed into a lamppost.' },
                { verb: 'Crossed', example: 'We crossed the street carefully.' },
                { verb: 'Danced', example: 'They danced all night at the party.' },
                { verb: 'Developed', example: 'The city developed quickly last year.' },
                { verb: 'Dressed', example: 'She dressed elegantly for the event.' },
                { verb: 'Dropped', example: 'Be careful, you dropped your keys!' },
                { verb: 'Escaped', example: 'The prisoner escaped from jail.' },
                { verb: 'Finished', example: 'I finally finished my project.' },
                { verb: 'Fixed', example: 'The plumber fixed the leaky faucet.' },
                { verb: 'Guessed', example: 'I guessed the correct answer.' },
                { verb: 'Helped', example: 'My neighbor helped me move the furniture.' },
                { verb: 'Hiked', example: 'We hiked up the mountain trail.' },
                { verb: 'Hoped', example: 'I hoped for good weather tomorrow.' },
                { verb: 'Introduced', example: 'She introduced me to her family.' },
                { verb: 'Jumped', example: 'The cat jumped onto the shelf.' },
                { verb: 'Kicked', example: 'He kicked the ball out of bounds.' },
                { verb: 'Laughed', example: 'Everyone laughed at the joke.' },
                { verb: 'Looked', example: 'I looked for my glasses everywhere.' },
                { verb: 'Missed', example: 'We missed the bus this morning.' },
                { verb: 'Passed', example: 'I passed the exam easily.' },
                { verb: 'Picked', example: 'He picked up the dropped pen.' },
                { verb: 'Practiced', example: 'They practiced guitar for hours.' },
                { verb: 'Pushed', example: 'I pushed the heavy door open.' },
                { verb: 'Relaxed', example: 'We relaxed on the beach all day.' },
                { verb: 'Searched', example: 'I searched for the information online.' },
                { verb: 'Shared', example: 'She shared her lunch with me.' },
                { verb: 'Shopped', example: 'We shopped for groceries on Friday.' },
                { verb: 'Skipped', example: 'He skipped the difficult questions.' },
                { verb: 'Stopped', example: 'The car stopped at the red light.' },
                { verb: 'Talked', example: 'We talked about our plans for the trip.' },
                { verb: 'Tasted', example: 'I tasted the spicy curry carefully.' },
                { verb: 'Touched', example: 'She touched the cold glass.' },
                { verb: 'Washed', example: 'He washed the dishes after dinner.' },
                { verb: 'Watched', example: 'We watched a movie last night.' },
                { verb: 'Worked', example: 'I worked ten hours yesterday.' },
                { verb: 'Worried', example: 'I worried about the test results.' }
            ],
            d: [
                { verb: 'Answered', example: 'He answered the email promptly.' },
                { verb: 'Allowed', example: 'The teacher allowed us to leave early.' },
                { verb: 'Belonged', example: 'This coat belonged to my father.' },
                { verb: 'Called', example: 'She called her mom yesterday.' },
                { verb: 'Changed', example: 'The weather changed suddenly.' },
                { verb: 'Cleaned', example: 'We cleaned the house all weekend.' },
                { verb: 'Climbed', example: 'They climbed to the top of the hill.' },
                { verb: 'Closed', example: 'The store closed at 9 PM.' },
                { verb: 'Compared', example: 'I compared the prices of the two phones.' },
                { verb: 'Covered', example: 'Snow covered the entire city.' },
                { verb: 'Damaged', example: 'The storm damaged the roof.' },
                { verb: 'Delayed', example: 'The flight was delayed due to fog.' },
                { verb: 'Enjoyed', example: 'We enjoyed the concert very much.' },
                { verb: 'Explained', example: 'The professor explained the theory.' },
                { verb: 'Filled', example: 'She filled the glass with water.' },
                { verb: 'Followed', example: 'I followed the recipe exactly.' },
                { verb: 'Happened', example: 'What happened here last night?' },
                { verb: 'Imagined', example: 'I imagined a world without limits.' },
                { verb: 'Joined', example: 'He joined the conversation late.' },
                { verb: 'Killed', example: 'The virus killed many plants.' },
                { verb: 'Listened', example: 'We listened to music on the radio.' },
                { verb: 'Lived', example: 'They lived in London for five years.' },
                { verb: 'Loved', example: 'I loved that movie! It was great.' },
                { verb: 'Managed', example: 'She managed the project successfully.' },
                { verb: 'Measured', example: 'He measured the wood before cutting it.' },
                { verb: 'Moved', example: 'I moved the chair closer to the table.' },
                { verb: 'Named', example: 'They named their daughter Sofia.' },
                { verb: 'Opened', example: 'I opened the window for fresh air.' },
                { verb: 'Planned', example: 'We planned the trip in advance.' },
                { verb: 'Played', example: 'The children played outside yesterday.' },
                { verb: 'Pulled', example: 'He pulled the door hard to open it.' },
                { verb: 'Realized', example: 'I realized my mistake immediately.' },
                { verb: 'Remembered', example: 'She remembered his name instantly.' },
                { verb: 'Saved', example: 'I saved the document before closing.' },
                { verb: 'Signed', example: 'He signed the contract this morning.' },
                { verb: 'Stayed', example: 'We stayed at a hotel downtown.' },
                { verb: 'Traveled', example: 'I traveled to Italy last month.' },
                { verb: 'Tried', example: 'She tried to fix the computer.' },
                { verb: 'Used', example: 'I used my phone to take a picture.' },
                { verb: 'Worried', example: 'I worried about the test results.' }
            ]
        };

        let practiceMode = false;
        let practicedVerbs = new Set();
        let currentFilter = 'all';
        let currentQuizVerb = null;
        let quizCorrect = 0;
        let quizTotal = 0;

        function getAudioPaths(verb, category) {
            const folders = ['id_sound/', 't_sound/', 'd_sound/'];
            const folderName = folders[['id', 't', 'd'].indexOf(category)];
            
            const basePaths = [
                folderName,
                `audio/${folderName}`,
                `audios/${folderName}`,
                `sound/${folderName}`,
                `sounds/${folderName}`,
                `../audio/${folderName}`,
            ];
            
            const nameVariations = [
                `${verb}..mp3`,
                `${verb}.mp3`,
                `${verb.toLowerCase()}.mp3`,
                `${verb.toLowerCase()}..mp3`,
                `${verb} .mp3`,
                `${verb}_.mp3`,
                `${verb}_ed.mp3`,
            ];
            
            const allPaths = [];
            for (const base of basePaths) {
                for (const name of nameVariations) {
                    allPaths.push(`${base}${name}`);
                }
            }
            
            return allPaths;
        }

        function init() {
            renderVerbLists();
            setupEventListeners();
            updateStats();
        }

        function renderVerbLists() {
            const container = document.getElementById('verbListContainer');
            container.innerHTML = '';

            const titles = {
                id: 'üî¥ Verbos /…™d/ - S√≠laba Extra',
                t: 'üü° Verbos /t/ - Sonidos Sordos',
                d: 'üü¢ Verbos /d/ - Sonidos Sonoros'
            };

            Object.keys(verbData).forEach(category => {
                if (currentFilter !== 'all' && currentFilter !== category) return;

                const verbList = document.createElement('div');
                verbList.className = `verb-list ${category}-list`;
                verbList.innerHTML = `<h3>${titles[category]}</h3><div class="verb-grid" id="grid-${category}"></div>`;
                container.appendChild(verbList);

                const grid = document.getElementById(`grid-${category}`);
                
                verbData[category].forEach(item => { 
                    const verbItem = document.createElement('div');
                    verbItem.className = 'verb-item';
                    
                    if (practicedVerbs.has(item.verb)) verbItem.classList.add('played');
                    verbItem.textContent = item.verb;
                    
                    const exampleSpan = document.createElement('span');
                    exampleSpan.className = 'example-text';
                    exampleSpan.innerHTML = `<strong>Ejemplo:</strong><br>${item.example}`; 
                    verbItem.appendChild(exampleSpan);

                    verbItem.onclick = () => playAudio(item.verb, category);
                    grid.appendChild(verbItem);
                });
            });
        }

        async function playAudio(verb, category) {
            practicedVerbs.add(verb);
            updateStats();
            renderVerbLists();

            const audioElement = document.getElementById('audioElement');
            const audioPlayer = document.getElementById('audioPlayer');
            const audioTitle = document.getElementById('audioTitle');

            const paths = getAudioPaths(verb, category);
            
            audioTitle.textContent = `üîä ${verb}`;
            audioPlayer.classList.add('show');

            let audioLoaded = false;

            for (const path of paths) {
                try {
                    audioElement.src = path;
                    await audioElement.play();
                    audioLoaded = true;
                    break;
                } catch (error) {
                    continue;
                }
            }

            if (!audioLoaded) {
                audioTitle.textContent = `‚ùå Audio no encontrado: ${verb}`;
                setTimeout(() => audioPlayer.classList.remove('show'), 2000);
            }

            audioElement.onended = () => {
                setTimeout(() => audioPlayer.classList.remove('show'), 500);
            };
        }

        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                document.querySelectorAll('.verb-item').forEach(item => {
                    item.style.display = item.textContent.toLowerCase().includes(searchTerm) ? 'block' : 'none';
                });
            });

            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    renderVerbLists();
                });
            });
        }

        function togglePracticeMode() {
            practiceMode = !practiceMode;
            document.getElementById('rulesSection').classList.toggle('hidden');
            document.getElementById('verbListsSection').classList.toggle('hidden');
            document.getElementById('practiceMode').classList.toggle('active');
            document.getElementById('dragDropChallenge').classList.add('hidden'); 
            if (practiceMode) startQuiz();
        }

        function startQuiz() {
            document.getElementById('nextQuestionBtn').classList.remove('hidden');
            nextQuestion();
        }

        function nextQuestion() {
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('correct', 'incorrect');
                opt.onclick = () => checkAnswer(opt.getAttribute('data-value'), opt); 
            });
            document.getElementById('dragDropChallenge').classList.add('hidden');
            document.getElementById('quizVerb').style.display = 'block';
            document.getElementById('quizOptions').style.display = 'grid';
            document.getElementById('nextQuestionBtn').classList.add('hidden'); 

            const categories = Object.keys(verbData);
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const verbs = verbData[randomCategory]; 
            
            const randomVerbObject = verbs[Math.floor(Math.random() * verbs.length)];
            
            currentQuizVerb = {
                verb: randomVerbObject.verb,
                category: randomCategory,
                example: randomVerbObject.example
            };

            document.getElementById('quizVerb').textContent = currentQuizVerb.verb;

            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = '';

            const options = [
                { label: 'üî¥ /…™d/ - S√≠laba extra', value: 'id' },
                { label: 'üü° /t/ - Sonido sordo', value: 't' },
                { label: 'üü¢ /d/ - Sonido sonoro', value: 'd' }
            ];

            options.forEach(option => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'quiz-option';
                optionDiv.textContent = option.label;
                optionDiv.setAttribute('data-value', option.value); 
                optionDiv.onclick = () => checkAnswer(option.value, optionDiv);
                optionsContainer.appendChild(optionDiv);
            });
        }

        function checkAnswer(selected, element) {
            quizTotal++;
            
            document.querySelectorAll('.quiz-option').forEach(opt => opt.onclick = null);

            if (selected === currentQuizVerb.category) {
                element.classList.add('correct');
                playAudio(currentQuizVerb.verb, currentQuizVerb.category);
                setTimeout(() => startDragDropChallenge(), 1500); 

            } else {
                element.classList.add('incorrect');
                document.querySelectorAll('.quiz-option').forEach(opt => {
                    if (opt.getAttribute('data-value') === currentQuizVerb.category) {
                        opt.classList.add('correct');
                    }
                });
                updateQuizScore();
                document.getElementById('nextQuestionBtn').classList.remove('hidden');
                document.getElementById('nextQuestionBtn').textContent = "Continuar ‚û°Ô∏è";
                
            }
        }

        // üß© FUNCIONES DRAG & DROP (MEJORADAS PARA M√ìVIL)
        
        // 1. Funci√≥n com√∫n que procesa la respuesta (sea por Drag o por Click)
        function finalizeAnswer(soundValue, elementId) {
            const dropZone = document.getElementById('dropZone');
            const challengeFeedback = document.getElementById('challengeFeedback');
            const element = document.getElementById(elementId);

            // Si ya se ha respondido, no permitir m√°s interacciones
            if(dropZone.classList.contains('correct') || dropZone.classList.contains('incorrect')) return;

            // Ocultar el elemento seleccionado/arrastrado
            if(element) element.style.visibility = 'hidden';

            dropZone.textContent = soundValue.toUpperCase(); 

            if (soundValue === currentQuizVerb.category) {
                quizCorrect++; 
                updateQuizScore();
                dropZone.classList.add('correct');
                challengeFeedback.textContent = "¬°√âxito! üéâ El sonido coincide con la regla de la frase.";
                
                // Efecto visual extra para confirmar
                dropZone.style.transform = "scale(1.1)";
                setTimeout(() => dropZone.style.transform = "scale(1)", 200);
            } else {
                dropZone.classList.add('incorrect');
                challengeFeedback.textContent = `‚ùå Incorrecto. El sonido correcto era: ${currentQuizVerb.category.toUpperCase()}`;
            }

            // Desactivar drop
            dropZone.ondrop = null;
            
            document.getElementById('nextQuestionBtn').classList.remove('hidden');
            document.getElementById('nextQuestionBtn').textContent = "Siguiente ‚û°Ô∏è";
        }

        // 2. Manejador del Drag (Inicio)
        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.getAttribute('data-sound'));
            ev.dataTransfer.setData("source-id", ev.target.id); 
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        // 3. Manejador del Drop (Soltar)
        function drop(ev) {
            ev.preventDefault();
            const draggedSound = ev.dataTransfer.getData("text");
            const draggedElementId = ev.dataTransfer.getData("source-id");
            
            finalizeAnswer(draggedSound, draggedElementId);
        }

        // 4. Nueva funci√≥n para manejar el Clic directo
        function handleClickOption(ev) {
            const sound = ev.target.getAttribute('data-sound');
            const id = ev.target.id;
            finalizeAnswer(sound, id);
        }

        function resetDropZone() {
            const dropZone = document.getElementById('dropZone');
            dropZone.classList.remove('correct', 'incorrect');
            // Texto actualizado para indicar que el clic tambi√©n funciona
            dropZone.textContent = "Arrastra o toca aqu√≠"; 
            dropZone.ondrop = drop; 
            dropZone.style.transform = "scale(1)";
            document.getElementById('challengeFeedback').textContent = "";
        }

        function startDragDropChallenge() {
            document.getElementById('quizVerb').style.display = 'none';
            document.getElementById('quizOptions').style.display = 'none';
            
            const challengeContainer = document.getElementById('dragDropChallenge');
            challengeContainer.classList.remove('hidden');

            resetDropZone(); 

            // Obtener la frase de ejemplo
            const regex = new RegExp(currentQuizVerb.verb, 'i');
            let sentence = currentQuizVerb.example.replace(regex, " [ ... ] "); // Placeholder m√°s corto
            document.getElementById('sentenceDisplay').innerHTML = `Frase: *${sentence}*`;

            // Crear las opciones
            const dragOptions = document.getElementById('dragOptions');
            dragOptions.innerHTML = '';
            
            const sounds = [
                { label: '/…™d/ (id)', value: 'id' },
                { label: '/t/ (t)', value: 't' },
                { label: '/d/ (d)', value: 'd' }
            ];

            sounds.sort(() => Math.random() - 0.5);

            sounds.forEach((sound, index) => {
                const option = document.createElement('div');
                option.className = 'drag-option';
                option.textContent = sound.label;
                option.id = `drag-${index}`; 
                
                // Atributos para Drag (PC)
                option.setAttribute('draggable', true);
                option.setAttribute('data-sound', sound.value);
                option.setAttribute('ondragstart', 'drag(event)');
                
                // ATRIBUTO PARA CLICK (M√ìVIL Y PC) - Soluciona tu problema
                option.onclick = handleClickOption;
                
                // Cursor pointer para indicar que es clicable
                option.style.cursor = 'pointer'; 
                option.style.visibility = 'visible'; 
                
                dragOptions.appendChild(option);
            });
        }
        // FIN FUNCIONES DRAG & DROP

        function updateStats() {
            document.getElementById('totalVerbs').textContent = Object.values(verbData).reduce((sum, arr) => sum + arr.length, 0);
            document.getElementById('practicedVerbs').textContent = practicedVerbs.size;
            document.getElementById('quizScore').textContent = `${quizCorrect}/${quizTotal}`;
        }

        function updateQuizScore() {
            document.getElementById('currentScore').textContent = `Puntuaci√≥n: ${quizCorrect}/${quizTotal} (${quizTotal > 0 ? Math.round(quizCorrect/quizTotal*100) : 0}%)`;
            updateStats();
        }

        window.onload = init;
    </script>

</body>
</html>
